# API Contract: Query Endpoint

## Endpoint: `/api/query`

### Description
This endpoint accepts user queries and returns responses generated by the RAG agent based on the indexed content.

### Method
`POST`

### Request Format
- Content-Type: `application/json`

### Request Body
```json
{
  "query": "string (required) - The user's query",
  "userId": "string (optional) - Identifier for the user",
  "context": "object (optional) - Additional context for the query"
}
```

### Response Format
- Content-Type: `application/json`

#### Success Response (200 OK)
```json
{
  "queryId": "string - Unique identifier for the query",
  "response": "string - The agent's response to the query",
  "sources": [
    {
      "title": "string - Title of the source document",
      "url": "string - URL of the source document",
      "excerpt": "string - Relevant excerpt from the source"
    }
  ],
  "timestamp": "string - ISO 8601 timestamp of the response"
}
```

#### Error Response (400 Bad Request)
```json
{
  "error": "string - Error message describing the issue",
  "code": "string - Error code",
  "timestamp": "string - ISO 8601 timestamp of the error"
}
```

#### Error Response (500 Internal Server Error)
```json
{
  "error": "string - Error message describing the issue",
  "code": "string - Error code",
  "timestamp": "string - ISO 8601 timestamp of the error"
}
```

### Example Request
```json
{
  "query": "What are the key components of a humanoid robot's control system?",
  "userId": "user-123"
}
```

### Example Response
```json
{
  "queryId": "query-456",
  "response": "The key components of a humanoid robot's control system include the central pattern generators (CPGs) for locomotion, inverse kinematics solvers for motion planning, and sensory feedback systems for balance and coordination.",
  "sources": [
    {
      "title": "Humanoid Robotics: A Reference",
      "url": "https://example.com/humanoid-robotics-reference",
      "excerpt": "The control system of a humanoid robot typically consists of multiple interconnected subsystems that work together to achieve stable and coordinated movement..."
    }
  ],
  "timestamp": "2025-12-27T12:00:00Z"
}
```

### Validation Rules
- The query field must be between 1 and 2000 characters
- The query field must not be empty or contain only whitespace
- The userId field, if provided, must be a valid string identifier